<div id="lilith-assistant-settings" class="inline-drawer">
    <div class="inline-drawer-toggle inline-drawer-header">
        <b>莉莉丝助手 (Lilith Assistant)</b>
        <div class="inline-drawer-icon fa-solid fa-circle-chevron-down"></div>
    </div>
    <div class="inline-drawer-content">
        <div class="settings_section">
            <p style="font-size: 0.9em; opacity: 0.8;">人格化的 AI 吐槽助手。您可以设置吐槽的频率、位置以及开启/关闭各项功能。</p>
        </div>

        <hr class="sysHR" />

        <!-- 吐槽频率设置 -->
        <div class="settings_section">
            <label for="lilith-comment-frequency">吐槽触发概率 (0-100%):</label>
            <div class="flex-container alignItemCenter">
                <input type="range" id="lilith-comment-frequency" min="0" max="100" step="1" style="flex: 1; margin-right: 10px;">
                <span id="lilith-freq-value" style="min-width: 40px; text-align: right;">0%</span>
            </div>
        </div>

        <!-- 插入位置设置 -->
        <div class="settings_section">
            <label for="lilith-comment-mode">吐槽插入位置 (正文互动):</label>
            <select id="lilith-comment-mode" class="text_pole">
                <option value="random">AI 自动定位 (智能注入)</option>
                <option value="bottom">始终追加在末尾</option>
                <option value="top">始终置于顶端</option>
            </select>
        </div>

        <hr class="sysHR" />

        <!-- [新增] 正文提取设置 -->
        <div class="settings_section">
            <h4 style="margin: 5px 0; opacity: 0.9;">正文提取 (Content Extraction)</h4>
            
            <!-- [新增] 正则方案联动 -->
            <div style="margin-bottom: 10px; background: rgba(0, 243, 255, 0.05); padding: 8px; border: 1px solid rgba(0, 243, 255, 0.2); border-radius: 4px;">
                <label style="font-size: 0.85em; color: var(--l-cyan); font-weight: bold;">🛡️ 方案管理 (Regex Presets)</label>
                <div class="flex-container alignItemCenter" style="gap: 5px; margin-top: 5px;">
                    <select id="lilith-regex-preset-select" class="text_pole" style="flex: 1; height: 30px;">
                        <option value="">-- 选择方案 --</option>
                    </select>
                    <button id="lilith-regex-save" class="menu_button" style="width: auto; padding: 0 10px;" title="将当前配置归档为方案">
                        <i class="fa-solid fa-floppy-disk"></i>
                    </button>
                    <button id="lilith-regex-delete" class="menu_button" style="width: auto; padding: 0 10px; color: var(--red);" title="从库中删除此方案">
                        <i class="fa-solid fa-trash-can"></i>
                    </button>
                </div>
                <div style="margin-top: 5px; display: none;" id="lilith-regex-name-container">
                    <input type="text" id="lilith-regex-new-name" class="text_pole" placeholder="输入新方案名称..." style="height: 25px; font-size: 0.8em;">
                </div>
            </div>

            <div class="flex-container alignItemCenter">
                <input type="checkbox" id="lilith-extraction-enabled">
                <label for="lilith-extraction-enabled">启用正文提取 (净化Lilith读取的内容)</label>
            </div>
            <div style="margin-top: 5px;">
                <label for="lilith-extraction-regex">前后正则 (用于切掉前后文):</label>
                <input type="text" id="lilith-extraction-regex" class="text_pole" placeholder="例如: <正文>|</正文> 或 (?s)<think>.*?</think>(.*)">
                <small style="opacity:0.7; font-size: 0.8em; display:block; margin-top:2px;">
                    规则：设定了前后正则后，Lilith只会读取和吐槽符合规则的内容。<br>
                    支持简写：&lt;开始标记&gt;|&lt;结束标记&gt; (自动提取中间内容)。
                </small>
            </div>

            <!-- [新增] 文字替换设置 -->
            <div style="margin-top: 10px; border-top: 1px dashed rgba(255, 255, 255, 0.1); padding-top: 10px;">
                <div class="flex-container alignItemCenter">
                    <input type="checkbox" id="lilith-text-replacement-enabled">
                    <label for="lilith-text-replacement-enabled">启用内容替换 (文字正则)</label>
                </div>
                <div style="margin-top: 5px;">
                    <label for="lilith-text-replacement-regex">文字正则 (用于替换内容):</label>
                    <input type="text" id="lilith-text-replacement-regex" class="text_pole" placeholder="例如: \[|\] 或 \[.*?\]">
                    <small style="opacity:0.7; font-size: 0.8em; display:block; margin-top:2px;">
                        规则：被匹配到的内容会被“替换为”中的内容取代。<br>
                        支持简写：A|B (自动匹配A...B之间的内容，如 [|] 匹配 [动作])。
                    </small>
                </div>
                <div style="margin-top: 5px;">
                    <label for="lilith-text-replacement-string">替换为 (留空则删除):</label>
                    <input type="text" id="lilith-text-replacement-string" class="text_pole" placeholder="">
                </div>
            </div>
            
            <div style="margin-top:10px; border: 1px solid var(--SmartThemeBorderColor); padding: 8px; border-radius: 4px; background: rgba(0,0,0,0.2);">
                <label style="font-weight:bold;">正则测试区</label>
                <textarea id="lilith-extraction-test-input" class="text_pole" rows="3" placeholder="在此输入测试文本..." style="margin:5px 0; width:100%; box-sizing:border-box;"></textarea>
                <div class="flex-container">
                     <button id="lilith-extraction-test-btn" class="menu_button" style="width: auto; padding: 5px 15px;">测试提取</button>
                </div>
                <div style="margin-top:5px;">
                    <label>提取结果:</label>
                    <div id="lilith-extraction-test-result" style="background:var(--SmartThemeInputBackground); color:var(--SmartThemeBodyColor); padding:5px; min-height:20px; white-space: pre-wrap; border-radius:4px; border: 1px solid var(--SmartThemeBorderColor); font-family: monospace;"></div>
                </div>
            </div>
        </div>

        <hr class="sysHR" />

        <!-- 开关选项 -->
        <div class="settings_section flex-container alignItemCenter">
            <input type="checkbox" id="lilith-hide-avatar">
            <label for="lilith-hide-avatar">隐藏右下角看板娘 (仅保留正文渲染)</label>
        </div>

        <div class="settings_section flex-container" style="gap:10px; margin-top: 10px;">
            <button id="lilith-manual-comment" class="menu_button" style="flex:1; display:flex; align-items:center; justify-content:center; gap:5px; border-color: #bd00ff66;">
                <i class="fa-solid fa-comment-dots"></i> 强制吐槽
            </button>
            <button id="lilith-reset-pos" class="menu_button" style="flex:1; display:flex; align-items:center; justify-content:center; gap:5px;">
                <i class="fa-solid fa-location-arrow"></i> 重置位置
            </button>
            <button id="lilith-toggle-panel" class="menu_button" style="flex:1; display:flex; align-items:center; justify-content:center; gap:5px;">
                <i class="fa-solid fa-window-maximize"></i> 开关面版
            </button>
        </div>

        <div class="settings_section">
            <label for="lilith-avatar-size">看板娘显示尺寸 (px):</label>
            <input type="number" id="lilith-avatar-size" class="text_pole" min="50" max="500" step="10">
        </div>

        <hr class="sysHR" />

        <div class="settings_section">
            <button id="lilith-reset-state" class="menu_button" style="color: #ff5555; border-color: rgba(255, 85, 85, 0.3); width: 100%; display:flex; align-items:center; justify-content:center; gap:5px;">
                <i class="fa-solid fa-triangle-exclamation"></i> 危险：清空好感度与记忆
            </button>
        </div>
    </div>
</div>
